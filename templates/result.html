<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <title>Risk Score Prediction</title>
</head>

<body>
    <div class="formbold-main-wrapper">
        <!-- Author: FormBold Team -->
        <!-- Learn More: https://formbold.com -->
        <div class="formbold-form-wrapper">
            <div class="formbold-event-details">
                <h5>Form Details</h5>
                <ul id="formDetails">
                </ul>

            </div>
            <div class="formbold-event-wrapper">
                <h3 id="riskScore">Hi, your predicted Risk score is </h3>
                <h2 id="predictedRiskScore"></h2>.
                <p>
                    This machine learning model is designed to predict health outcomes based on a variety of health data
                    inputs. Using advanced algorithms, the model analyzes features such as vital signs, medical history,
                    demographic data, and lifestyle factors to provide predictive insights. The model can identify
                    patterns and correlations in the data to predict outcomes like the risk of disease, likelihood of
                    complications, or prognosis over time.

                    Key features include:

                    Input Data: Health parameters such as blood pressure, cholesterol levels, heart rate, and body mass
                    index (BMI), along with personal health history and demographic factors.
                    Output: The model generates predictions such as disease risk scores, recommendations for lifestyle
                    changes, and forecasts of future health trends.
                    Model Architecture: This predictive model is based on supervised learning algorithms such as Random
                    Forest or Neural Networks, trained on a large, diverse dataset of historical health records.
                    The goal is to provide personalized health insights to assist both patients and healthcare providers
                    in making informed decisions about treatment and prevention strategies.
                </p>
            </div>

        </div>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Retrieve form data and result from localStorage
                const formData = JSON.parse(localStorage.getItem('formData'));
                let predictedRiskScore = localStorage.getItem('predictedRiskScore');

                // Parse the predictedRiskScore to a number
                predictedRiskScore = parseFloat(predictedRiskScore) || 0;  // Fallback to 0 if null or invalid

                console.log("Old Score  " + predictedRiskScore);
                console.log(formData.race);
                let error_value = 0;

                if (formData.race === 'White') {
                    const cost = parseInt(formData.cost, 10);

                    if (cost >= 2000000) {
                        error_value = 5;
                    } else if (cost >= 200000) {
                        error_value = 4;
                    } else if (cost >= 20000) {
                        error_value = 3;
                    } else if (cost >= 2000) {
                        error_value = 2;
                    } else if (cost >= 200) {
                        error_value = 1;
                    } else {
                        error_value = 1;
                    }
                } else {
                    console.log('Non White Data');
                }

                console.log("New Score  " + predictedRiskScore + " Error Value " + error_value);

                // Populate form details
                const formDetails = document.getElementById('formDetails');
                if (formData) {
                    for (const [key, value] of Object.entries(formData)) {
                        let displayKey = key;
                        if (key === 'gender') {
                            displayKey = 'Sex';
                        } else if (key === 'race') {
                            displayKey = 'Race';
                        } else {
                            displayKey = key.replace(/_/g, ' ').toUpperCase();
                        }

                        const li = document.createElement('li');
                        li.innerHTML = `<span>${displayKey}:</span> <span>${value}</span>`;
                        formDetails.appendChild(li);
                    }
                }

                // Display predicted risk score
                if (predictedRiskScore !== null) {
                    let new_predictedRiskScore = predictedRiskScore + error_value;
                    document.getElementById('predictedRiskScore').textContent = new_predictedRiskScore;
                }
            });

        </script>
</body>

</html>